$(function() {

    var is_video_chat = $(".video_chat").size()>0 ? true : false;
    if (is_video_chat) {

      rtc.on('add remote stream', function(stream, id){
        // show the remote video
        $video = $('<video id="'+id+'" autoplay="autoplay"></video>');
        $('div#remote').append($video);
        $video.on("click", function(){
          $("#remote").append($("#pickup").children());
          $("#pickup").append($(this));
          $("#remote").children().each(function(){
            this.play();
          });
          this.play();
        });
        rtc.attachStream(stream, id.toString());
      });
      rtc.on('disconnect stream', function(id){
        $('#'+id).remove();
      });

      var $button = $('<input type="button" class="btn btn-small" value="ビデオチャット開始" id="video_chat_on" />');
      $('p.logout').append($button);

      $button.on("click", function() {

        rtc.connect('ws://<%= ENV['WEBRTC_HOST'] %>', 'tiramisu-channel-'+channelId);

        rtc.createStream({"video": true, "audio":true}, function(stream){
          // get local stream for manipulation
          rtc.attachStream(stream, 'local');
        });

        $(this).remove();

      });
    }
});
